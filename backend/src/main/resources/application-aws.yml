# ============================================================================
# AWS SINGLE EC2 INSTANCE DEPLOYMENT PROFILE
# ============================================================================
# Use this profile for single EC2 deployment: --spring.profiles.active=aws

spring:
  config:
    activate:
      on-profile: aws

  # Database - Amazon RDS PostgreSQL
  datasource:
    url: jdbc:postgresql://${DB_HOST}:${DB_PORT:5432}/${DB_NAME:campcard}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      idle-timeout: 300000
      max-lifetime: 600000
      connection-timeout: 20000

  jpa:
    hibernate:
      ddl-auto: none  # Schema managed by Flyway migrations, validation disabled due to entity/schema drift
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        "[default_schema]": campcard
        format_sql: false

  # Flyway - Database migrations
  flyway:
    enabled: true
    baseline-on-migrate: true
    baseline-version: 9  # Skip V001-V009 since database already has tables in campcard schema
    locations: classpath:db/migration
    schemas: campcard
    default-schema: campcard
    out-of-order: true  # Allow migrations to run out of order

  # Redis - ElastiCache (with TLS)
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      ssl:
        enabled: ${REDIS_SSL:true}

  # Kafka - MSK or local Kafka on EC2
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

  # Email - Amazon SES
  mail:
    host: ${SMTP_HOST:email-smtp.us-east-1.amazonaws.com}
    port: ${SMTP_PORT:587}
    username: ${SMTP_USERNAME}
    password: ${SMTP_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true

# Security
security:
  jwt:
    secret: ${JWT_SECRET}
    expiration: ${JWT_EXPIRATION:86400000}  # 24 hours (was 15 minutes)
    refresh-expiration: 604800000  # 7 days
    issuer: campcard-api

  cors:
    allowed-origins:
      - ${CORS_ALLOWED_ORIGINS:*}

# Server
server:
  port: ${SERVER_PORT:7010}

# Logging - production level
logging:
  level:
    root: INFO
    org.bsa.campcard: INFO
    com.bsa.campcard.service.PaymentService: DEBUG
    org.springframework.security: WARN
    org.hibernate.SQL: WARN
  file:
    name: /var/log/campcard/api.log

# Authorize.Net Payment Gateway (Sandbox for testing)
authorize:
  net:
    api:
      login:
        id: ${AUTHORIZE_NET_API_LOGIN_ID:7adF5E2X}
    transaction:
      key: ${AUTHORIZE_NET_TRANSACTION_KEY:2Jn3332L96UNwffN}
    environment: ${AUTHORIZE_NET_ENVIRONMENT:SANDBOX}

# Together.AI Configuration
together:
  ai:
    api-key: ${TOGETHER_AI_API_KEY:}
    base-url: https://api.together.xyz/v1
    default-model: meta-llama/Llama-3.3-70B-Instruct-Turbo

# AWS SNS Push Notifications
aws:
  region: ${AWS_REGION:us-east-2}
  sns:
    region: ${AWS_SNS_REGION:us-east-1}
    platform-application-arn:
      ios: ${SNS_PLATFORM_ARN_IOS:arn:aws:sns:us-east-1:858955002750:app/APNS/camp-card-mobile-app}
      android: ${SNS_PLATFORM_ARN_ANDROID:arn:aws:sns:us-east-1:858955002750:app/GCM/camp-card-mobile-android}

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
