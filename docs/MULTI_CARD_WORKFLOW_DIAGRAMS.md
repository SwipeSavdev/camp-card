# Multi-Card System - Complete Workflow Diagrams

This document provides detailed visual diagrams for all multi-card system workflows.

---

## Table of Contents

1. [Flow 1: New User Purchase](#flow-1-new-user-purchase)
2. [Flow 2: Existing User - Buy More Cards](#flow-2-existing-user---buy-more-cards)
3. [Flow 3: Gift a Card](#flow-3-gift-a-card)
4. [Flow 4: Replenish Offers](#flow-4-replenish-offers)
5. [Flow 5: Offer Redemption](#flow-5-offer-redemption)
6. [Card Status State Machine](#card-status-state-machine)
7. [Notification Schedule](#notification-schedule)

---

## Flow 1: New User Purchase

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              NEW USER PURCHASE FLOW                                          │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

                         ┌──────────────────────────────┐
                         │      User Opens App          │
                         │      (Not Logged In)         │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
                         ┌──────────────────────────────┐
                         │    Select Subscription       │
                         │    ┌────────┐ ┌────────┐     │
                         │    │  $10   │ │  $15   │     │
                         │    │ Scout  │ │ Direct │     │
                         │    │Referral│ │Purchase│     │
                         │    └────────┘ └────────┘     │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
                         ┌──────────────────────────────┐
                         │    Select Quantity           │
                         │                              │
                         │    ┌─┬─┬─┬─┬─┬─┬─┬─┬─┬──┐   │
                         │    │1│2│3│4│5│6│7│8│9│10│   │
                         │    └─┴─┴─┴─┴─┴─┴─┴─┴─┴──┘   │
                         │                              │
                         │    (Max 10 cards per order)  │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
                         ┌──────────────────────────────┐
                         │    Enter Payment Details     │
                         │                              │
                         │    Card Number: ____________ │
                         │    Expiry: _____ CVV: ____   │
                         │                              │
                         │    [Authorize.net Secure]    │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
                              ┌─────────────────┐
                             ╱                   ╲
                            ╱    Payment         ╲
                           ╱     Success?         ╲
                           ╲                      ╱
                            ╲                    ╱
                             ╲                  ╱
                              └────────┬───────┘
                                       │
                       ┌───────────────┴───────────────┐
                       │                               │
                       ▼                               ▼
              ┌────────────────┐              ┌────────────────┐
              │      YES       │              │       NO       │
              └───────┬────────┘              └───────┬────────┘
                      │                               │
                      ▼                               ▼
         ┌──────────────────────────┐    ┌──────────────────────────┐
         │   Create Account         │    │   Show Error Message     │
         │                          │    │                          │
         │   Email: ____________    │    │   "Payment failed.       │
         │   Password: _________    │    │    Please try again."    │
         │   First Name: _______    │    │                          │
         │   Last Name: ________    │    │   [Retry Payment]        │
         └───────────┬──────────────┘    └──────────────────────────┘
                     │                               │
                     ▼                               │
         ┌──────────────────────────┐               │
         │   Cards Created!         │               │
         │                          │◄──────────────┘
         │   Card 1: CC-XXXX  ✓     │   (on retry success)
         │   Status: ACTIVE         │
         │                          │
         │   Card 2: CC-XXXX        │
         │   Status: UNASSIGNED     │
         │                          │
         │   Card 3: CC-XXXX        │
         │   Status: UNASSIGNED     │
         └───────────┬──────────────┘
                     │
                     ▼
         ┌──────────────────────────┐
         │   Navigate to            │
         │   Card Wallet            │
         │                          │
         │   Welcome to Camp Card!  │
         └──────────────────────────┘
```

---

## Flow 2: Existing User - Buy More Cards

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              EXISTING USER - BUY MORE CARDS                                  │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

                         ┌──────────────────────────────┐
                         │   User Logged In             │
                         │   Profile Screen             │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
                         ┌──────────────────────────────┐
                         │   Tap "My Cards"             │
                         │   in Profile Menu            │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
         ┌──────────────────────────────────────────────────────────────┐
         │                        CARD WALLET                            │
         │                                                               │
         │   ┌─────────────────────────────────────────────────────┐    │
         │   │  ACTIVE CARD                                        │    │
         │   │  CC-1234-5678-9012                                   │    │
         │   │  Offers Used: 42/47        Expires: Dec 31, 2026    │    │
         │   └─────────────────────────────────────────────────────┘    │
         │                                                               │
         │   ┌─────────────────────────────────────────────────────┐    │
         │   │  UNUSED CARDS (2)                                   │    │
         │   │  • CC-2345-6789-0123                                 │    │
         │   │  • CC-3456-7890-1234                                 │    │
         │   └─────────────────────────────────────────────────────┘    │
         │                                                               │
         │                    ┌─────────────────────┐                    │
         │                    │   + Buy More Cards  │                    │
         │                    └──────────┬──────────┘                    │
         └───────────────────────────────┼──────────────────────────────┘
                                         │
                                         ▼
                         ┌──────────────────────────────┐
                         │    Select Quantity           │
                         │    (1-10 cards)              │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
                         ┌──────────────────────────────┐
                         │    Complete Payment          │
                         │    (Same as Flow 1)          │
                         └──────────────┬───────────────┘
                                        │
                                        ▼
                         ┌──────────────────────────────┐
                         │    New Cards Added           │
                         │    to Wallet as UNASSIGNED   │
                         └──────────────────────────────┘
```

---

## Flow 3: Gift a Card

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              GIFT A CARD FLOW                                                │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

╔═══════════════════════════════════════╗    ╔═══════════════════════════════════════╗
║            SENDER SIDE                 ║    ║           RECIPIENT SIDE               ║
╚═══════════════════════════════════════╝    ╚═══════════════════════════════════════╝

┌───────────────────────────────────────┐
│   Card Wallet                         │
│                                       │
│   Select UNASSIGNED Card:             │
│   ┌─────────────────────────────┐     │
│   │ CC-2345-6789-0123           │     │
│   │ [Gift] [Activate]           │     │
│   └─────────────────────────────┘     │
└──────────────────┬────────────────────┘
                   │
                   ▼
┌───────────────────────────────────────┐
│   Tap "Gift This Card"                │
└──────────────────┬────────────────────┘
                   │
                   ▼
┌───────────────────────────────────────┐
│   Gift Card Screen                    │
│                                       │
│   Recipient Email:                    │
│   ┌─────────────────────────────┐     │
│   │ friend@example.com          │     │
│   └─────────────────────────────┘     │
│                                       │
│   Recipient Name (optional):          │
│   ┌─────────────────────────────┐     │
│   │ Jane Smith                  │     │
│   └─────────────────────────────┘     │
│                                       │
│   Gift Message (optional):            │
│   ┌─────────────────────────────┐     │
│   │ Enjoy savings at local      │     │
│   │ merchants! Happy shopping!  │     │
│   └─────────────────────────────┘     │
│   (500 character limit)               │
│                                       │
│         ┌───────────────────┐         │
│         │    Send Gift      │         │
│         └─────────┬─────────┘         │
└───────────────────┼───────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐    ┌───────────────────────────────────────┐
│   Card Status Updated                 │    │   Email Received                      │
│                                       │    │                                       │
│   CC-2345-6789-0123                   │───▶│   "You've received a Camp Card        │
│   Status: GIFTED                      │    │    gift from John Smith!"             │
│   Gifted to: friend@example.com       │    │                                       │
│   Sent: Jan 15, 2026                  │    │   [Claim Your Card]                   │
└───────────────────────────────────────┘    └──────────────────┬────────────────────┘
                                                                │
         ┌──────────────────────────────────────────────────────┘
         │
         ▼
┌───────────────────────────────────────┐
│   Recipient Clicks Claim Link         │
│   Opens: /claim/{gift_token}          │
└──────────────────┬────────────────────┘
                   │
                   ▼
          ┌────────────────┐
         ╱                  ╲
        ╱   Has Existing    ╲
       ╱    Account?         ╲
       ╲                     ╱
        ╲                   ╱
         ╲                 ╱
          └───────┬───────┘
                  │
      ┌───────────┴───────────┐
      │                       │
      ▼                       ▼
┌─────────────┐         ┌─────────────┐
│     NO      │         │     YES     │
└──────┬──────┘         └──────┬──────┘
       │                       │
       ▼                       ▼
┌───────────────────┐   ┌───────────────────┐
│  Create Account   │   │  Log In           │
│                   │   │                   │
│  Email: ________  │   │  Email: ________  │
│  Password: _____  │   │  Password: _____  │
│  Name: _________  │   │                   │
└────────┬──────────┘   └────────┬──────────┘
         │                       │
         └───────────┬───────────┘
                     │
                     ▼
┌───────────────────────────────────────┐
│   Gift Claim Confirmation             │
│                                       │
│   "John Smith sent you a Camp Card!"  │
│                                       │
│   Message: "Enjoy savings at local    │
│   merchants! Happy shopping!"         │
│                                       │
│         ┌───────────────────┐         │
│         │   Claim Card      │         │
│         └─────────┬─────────┘         │
└───────────────────┼───────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐    ┌───────────────────────────────────────┐
│   Card Claimed!                       │    │   Sender Notified                     │
│                                       │    │                                       │
│   CC-2345-6789-0123                   │    │   "Your gift to friend@example.com    │
│   Status: ACTIVE                      │◀───│    has been claimed!"                 │
│   Owner: friend@example.com           │    │                                       │
│                                       │    │   ✓ Gift successfully received        │
│   Navigate to Card Wallet             │    │                                       │
└───────────────────────────────────────┘    └───────────────────────────────────────┘
```

---

## Flow 4: Replenish Offers

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              REPLENISH OFFERS FLOW                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────────────────────────┐
│                                    CARD WALLET                                         │
│                                                                                        │
│   ┌────────────────────────────────────────────────────────────────────────────┐      │
│   │  ACTIVE CARD                                                                │      │
│   │  CC-1234-5678-9012                                                          │      │
│   │                                                                             │      │
│   │  ████████████████████████████████████████░░░░░░░  42/47 offers used        │      │
│   │                                                                             │      │
│   │  ⚠️  Only 5 offers remaining!                                               │      │
│   │  Expires: December 31, 2026                                                 │      │
│   └────────────────────────────────────────────────────────────────────────────┘      │
│                                                                                        │
│   ┌────────────────────────────────────────────────────────────────────────────┐      │
│   │  UNUSED CARDS (1)                                                          │      │
│   │                                                                             │      │
│   │  ┌────────────────────────────────────────────────────────────────────┐    │      │
│   │  │  CC-2345-6789-0123                                                  │    │      │
│   │  │  Status: UNASSIGNED                                                 │    │      │
│   │  │  Expires: December 31, 2026                                         │    │      │
│   │  │                                                                     │    │      │
│   │  │  ┌──────────────────┐  ┌────────────────────────┐                   │    │      │
│   │  │  │   Gift Card      │  │   Replenish Offers     │ ◀── User taps    │    │      │
│   │  │  └──────────────────┘  └───────────┬────────────┘                   │    │      │
│   │  └────────────────────────────────────┼────────────────────────────────┘    │      │
│   └───────────────────────────────────────┼─────────────────────────────────────┘      │
└───────────────────────────────────────────┼───────────────────────────────────────────┘
                                            │
                                            ▼
                    ┌───────────────────────────────────────────────┐
                    │           CONFIRMATION MODAL                   │
                    │                                                │
                    │   ┌────────────────────────────────────────┐  │
                    │   │                                        │  │
                    │   │   Replenish Your Offers?               │  │
                    │   │                                        │  │
                    │   │   This will:                           │  │
                    │   │   • Deactivate your current card       │  │
                    │   │   • Activate the selected card         │  │
                    │   │   • Reset all 47 offers to unused      │  │
                    │   │                                        │  │
                    │   │   Current card (CC-1234) will be       │  │
                    │   │   marked as REPLACED.                  │  │
                    │   │                                        │  │
                    │   │   ┌────────────┐  ┌────────────────┐   │  │
                    │   │   │   Cancel   │  │    Confirm     │   │  │
                    │   │   └────────────┘  └───────┬────────┘   │  │
                    │   │                           │            │  │
                    │   └───────────────────────────┼────────────┘  │
                    └───────────────────────────────┼───────────────┘
                                                    │
                                                    ▼
                              ┌──────────────────────────────────────┐
                              │   Processing...                      │
                              │                                      │
                              │   1. Old card → REPLACED             │
                              │   2. New card → ACTIVE               │
                              │   3. Offers reset: 0/47 used         │
                              └──────────────────┬───────────────────┘
                                                 │
                                                 ▼
┌───────────────────────────────────────────────────────────────────────────────────────┐
│                                    CARD WALLET                                         │
│                                                                                        │
│   ┌────────────────────────────────────────────────────────────────────────────┐      │
│   │  ACTIVE CARD                                                 ✓ NEW!        │      │
│   │  CC-2345-6789-0123                                                          │      │
│   │                                                                             │      │
│   │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  0/47 offers used        │      │
│   │                                                                             │      │
│   │  All 47 offers available!                                                   │      │
│   │  Expires: December 31, 2026                                                 │      │
│   └────────────────────────────────────────────────────────────────────────────┘      │
│                                                                                        │
│   ┌────────────────────────────────────────────────────────────────────────────┐      │
│   │  REPLACED CARDS                                                            │      │
│   │                                                                             │      │
│   │  • CC-1234-5678-9012 (replaced on Jan 20, 2026)                            │      │
│   └────────────────────────────────────────────────────────────────────────────┘      │
│                                                                                        │
│   ┌────────────────────────────────────────────────────────────────────────────┐      │
│   │  UNUSED CARDS (0)                                                          │      │
│   │                                                                             │      │
│   │  No unused cards. [Buy More Cards]                                         │      │
│   └────────────────────────────────────────────────────────────────────────────┘      │
└───────────────────────────────────────────────────────────────────────────────────────┘
```

---

## Flow 5: Offer Redemption

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              OFFER REDEMPTION FLOW                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────┐                    ┌───────────────────────────────┐
│         USER (Mobile)         │                    │       MERCHANT (POS)          │
└───────────────────────────────┘                    └───────────────────────────────┘

┌───────────────────────────────┐
│   Card Wallet                 │
│                               │
│   Tap Active Card to          │
│   Show QR Code                │
└──────────────┬────────────────┘
               │
               ▼
┌───────────────────────────────┐
│   ┌─────────────────────┐     │
│   │ ▄▄▄▄▄▄▄ ▄▄▄ ▄▄▄▄▄▄▄ │     │
│   │ █ ▄▄▄ █ █▄█ █ ▄▄▄ █ │     │
│   │ █ ███ █ ▄▄▄ █ ███ █ │     │                    ┌───────────────────────────────┐
│   │ █▄▄▄▄▄█ █▄█ █▄▄▄▄▄█ │     │                    │   Merchant Scans QR Code      │
│   │ ▄▄▄▄▄ ▄▄▄▄▄ ▄▄▄▄▄▄▄ │     │ ─────────────────▶ │                               │
│   │ █████ █████ ███████ │     │                    │   Card: CC-2345-6789-0123     │
│   │ ▀▀▀▀▀▀▀ ▀▀▀ ▀▀▀▀▀▀▀ │     │                    │   Status: VALID ✓             │
│   └─────────────────────┘     │                    └──────────────┬────────────────┘
│                               │                                   │
│   CC-2345-6789-0123           │                                   ▼
│   Tap to view offers          │                    ┌───────────────────────────────┐
└───────────────────────────────┘                    │   Select Offer                │
                                                     │                               │
                                                     │   ☐ Joe's Pizza - 20% off     │
                                                     │   ☐ Main St Deli - $5 off     │
                                                     │   ☑ Bob's Burgers - BOGO      │
                                                     │   ☐ City Gym - Free Day Pass  │
                                                     │                               │
                                                     │   [Apply Discount]            │
                                                     └──────────────┬────────────────┘
                                                                    │
                                                                    ▼
                                                     ┌───────────────────────────────┐
                                                     │   Discount Applied!           │
                                                     │                               │
                                                     │   Bob's Burgers - BOGO        │
                                                     │   Savings: $12.99             │
                                                     │                               │
                                                     │   ✓ Redemption Recorded       │
                                                     └──────────────┬────────────────┘
                                                                    │
               ┌────────────────────────────────────────────────────┘
               │
               ▼
┌───────────────────────────────┐
│   Offer Redeemed!             │
│                               │
│   Bob's Burgers - BOGO        │
│   You saved: $12.99           │
│                               │
│   Offers used: 1/47           │
│   Total savings: $12.99       │
└───────────────────────────────┘
```

---

## Card Status State Machine

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              CARD STATUS STATE MACHINE                                       │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

                                    ┌─────────────────┐
                                    │    PURCHASE     │
                                    │    (1-10 cards) │
                                    └────────┬────────┘
                                             │
                  ┌──────────────────────────┼──────────────────────────┐
                  │                          │                          │
                  ▼                          ▼                          ▼
         ┌────────────────┐         ┌────────────────┐         ┌────────────────┐
         │                │         │                │         │                │
         │     ACTIVE     │         │  UNASSIGNED    │         │  UNASSIGNED    │
         │  (1st card)    │         │  (2nd card)    │         │  (nth card)    │
         │                │         │                │         │                │
         └───────┬────────┘         └───────┬────────┘         └───────┬────────┘
                 │                          │                          │
                 │                          │                          │
    ┌────────────┼────────────┐    ┌───────┴────────┐         ┌───────┴────────┐
    │            │            │    │                │         │                │
    ▼            ▼            ▼    ▼                ▼         ▼                ▼
┌────────┐ ┌─────────┐ ┌─────────┐ ┌────────┐ ┌─────────┐ ┌─────────┐ ┌────────────┐
│REPLACED│ │ EXPIRED │ │ REVOKED │ │ GIFTED │ │ ACTIVE  │ │ EXPIRED │ │Dec 31 23:59│
│        │ │Dec 31st │ │ (Admin) │ │        │ │(activate│ │         │ │ All cards  │
│(replen-│ │         │ │         │ │        │ │   or    │ │         │ │  expire    │
│  ish)  │ │         │ │         │ │        │ │replenish│ │         │ │            │
└────────┘ └─────────┘ └─────────┘ └───┬────┘ └─────────┘ └─────────┘ └────────────┘
                                       │
                                       ▼
                              ┌────────────────┐
                              │                │
                              │     ACTIVE     │
                              │  (recipient    │
                              │   claims)      │
                              │                │
                              └────────────────┘
```

### Status Definitions

```
┌──────────────┬───────────────────────────────────────────────────────────────────────┐
│    STATUS    │                            DESCRIPTION                                │
├──────────────┼───────────────────────────────────────────────────────────────────────┤
│  UNASSIGNED  │  Purchased but not yet activated. Sits in user's wallet inventory.   │
├──────────────┼───────────────────────────────────────────────────────────────────────┤
│    ACTIVE    │  Currently in use. User can redeem offers with this card.            │
├──────────────┼───────────────────────────────────────────────────────────────────────┤
│    GIFTED    │  Sent as gift to another user. Pending recipient claim.              │
├──────────────┼───────────────────────────────────────────────────────────────────────┤
│   REPLACED   │  Deactivated when user replenished offers with a new card.           │
├──────────────┼───────────────────────────────────────────────────────────────────────┤
│   EXPIRED    │  Past December 31st expiry date. No longer usable.                   │
├──────────────┼───────────────────────────────────────────────────────────────────────┤
│   REVOKED    │  Administratively disabled by council/national admin.                │
└──────────────┴───────────────────────────────────────────────────────────────────────┘
```

---

## Notification Schedule

### December Expiry Timeline

```
┌─────────────────────────────────────────────────────────────────────────────────────────────┐
│                              EXPIRY NOTIFICATION SCHEDULE                                    │
└─────────────────────────────────────────────────────────────────────────────────────────────┘

    DECEMBER TIMELINE:
    ══════════════════════════════════════════════════════════════════════════════════════

    Dec 1                Dec 15               Dec 24       Dec 28        Dec 31
      │                    │                    │            │             │
      ▼                    ▼                    ▼            ▼             ▼
    ┌────┐              ┌────┐              ┌────┐       ┌────┐        ┌────────┐
    │ 30 │              │ 15 │              │  7 │       │  3 │        │ EXPIRE │
    │DAYS│              │DAYS│              │DAYS│       │DAYS│        │        │
    └────┘              └────┘              └────┘       └────┘        └────────┘
      │                    │                    │            │             │
      ▼                    ▼                    ▼            ▼             ▼
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │ Push + Email    Push + Email      Push + Email   Push + Email    All cards │
    │ "30 days left"  "15 days left"    "7 days left"  "3 DAYS LEFT!"  → EXPIRED │
    └─────────────────────────────────────────────────────────────────────────────┘
```

### Gift Claim Reminders

```
    GIFT CLAIM REMINDERS:
    ══════════════════════════════════════════════════════════════════════════════════════

    Gift Sent              +3 days             +7 days             +14 days
        │                     │                   │                    │
        ▼                     ▼                   ▼                    ▼
    ┌────────┐           ┌────────┐          ┌────────┐          ┌────────┐
    │ GIFTED │──────────▶│REMINDER│─────────▶│REMINDER│─────────▶│REMINDER│
    │        │           │   #1   │          │   #2   │          │   #3   │
    └────────┘           └────────┘          └────────┘          └────────┘
                              │                   │                    │
                              ▼                   ▼                    ▼
                         Email to sender:   Email to sender:    Email to sender:
                         "Gift unclaimed"   "Still unclaimed"   "Final reminder"
```

### Weekly Unused Card Reminder

```
    WEEKLY UNUSED CARD REMINDER:
    ══════════════════════════════════════════════════════════════════════════════════════

    Every Monday @ 10:00 AM
           │
           ▼
    ┌─────────────────────────────────────────────────────────────────────────────┐
    │  Check: Does user have UNASSIGNED cards?                                    │
    │                                                                             │
    │  If YES → Push notification:                                                │
    │           "You have 2 unused Camp Cards! Gift them or use for more offers!" │
    └─────────────────────────────────────────────────────────────────────────────┘
```

---

## API Endpoints Summary

| Endpoint | Method | Auth | Description |
|----------|--------|------|-------------|
| `/api/v1/cards/purchase` | POST | Optional | Purchase 1-10 cards |
| `/api/v1/cards/my-cards` | GET | Required | Get user's card inventory |
| `/api/v1/cards/{id}` | GET | Required | Get single card details |
| `/api/v1/cards/{id}/activate` | POST | Required | Activate card (replenish offers) |
| `/api/v1/cards/{id}/gift` | POST | Required | Send card as gift |
| `/api/v1/cards/{id}/cancel-gift` | POST | Required | Cancel pending gift |
| `/api/v1/cards/{id}/resend-gift` | POST | Required | Resend gift email |
| `/api/v1/cards/claim/{token}` | GET | None | Get gift details for claim page |
| `/api/v1/cards/claim/{token}` | POST | Optional | Claim gifted card |

---

## Related Documentation

- [MULTI_CARD_SYSTEM.md](./MULTI_CARD_SYSTEM.md) - Full system specification
- [Database Migration V025](../backend/src/main/resources/db/migration/V025__camp_cards_inventory_system.sql) - Schema definition
